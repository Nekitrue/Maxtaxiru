<script>
    // ... (весь ваш код до функции confirmOrder остается без изменений)

    function confirmOrder() {
        const fromInp = document.getElementById('from');
        const toInp = document.getElementById('to');
        let valid = true;

        [fromInp, toInp, ...document.querySelectorAll('.stop-input')].forEach(inp => {
            if (!hasHouse(inp.value)) {
                inp.classList.add('error');
                valid = false;
            } else {
                inp.classList.remove('error');
            }
        });

        if (!valid) {
            alert("Пожалуйста, укажите НОМЕР ДОМА в каждом адресе.");
            return;
        }
        
        document.getElementById('search-overlay').style.display = 'flex';
        
        // Собираем промежуточные точки в одну строку, если они есть
        const stopsArr = Array.from(document.querySelectorAll('.stop-input')).map(i => i.value).filter(v => v);
        const intermediateStops = stopsArr.length > 0 ? stopsArr.join(', ') : 'Нет';
        
        setTimeout(() => {
            document.getElementById('search-overlay').style.display = 'none';

            // ОТПРАВКА ДАННЫХ В БОТА (синхронизировано с вашим main.py)
            tg.sendData(JSON.stringify({
                from: fromInp.value,
                to: toInp.value,
                inter: intermediateStops,
                price: currentPrice,
                pay: paymentMethod,
                comment: document.getElementById('comment').value,
                city: detectedCity,
                v: "1.2.7"
            }));
            
            tg.close();
        }, 3000); // Уменьшил время ожидания для теста, можно вернуть 8000
    }
    
    // ... (остальные функции оставляем как есть)
</script>
