<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Такси MAX Neon Luxury - v2.1</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
:root{
--neon-yellow:#fcc200;
--neon-purple:#bc13fe;
--silver:#c0c0c0;
--bg-dark:#0d0d0d;
--card-bg:#1a1a1a;
--input-bg:#252525;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{
font-family:'Montserrat',sans-serif;
background:var(--bg-dark);
color:var(--silver);
margin:0;
padding:10px 15px 60px;
min-height:100vh
}
.container{
background:var(--card-bg);
border-radius:20px;
padding:20px;
box-shadow:0 0 25px rgba(188,19,254,.12)
}
.top-info-row{
display:flex;
justify-content:space-between;
align-items:center;
margin-bottom:5px
}
.version-label{font-size:9px;color:rgba(192,192,192,.4);font-weight:600}
#city-status{
font-size:9px;
font-weight:800;
text-decoration:underline;
cursor:pointer;
text-transform:uppercase
}
.field-group{margin-bottom:18px;position:relative}
label{
font-size:11px;
font-weight:800;
color:var(--neon-yellow);
text-transform:uppercase;
margin-bottom:8px;
display:block
}
.input-wrapper{position:relative}
input{
width:100%;
padding:14px 40px 14px 14px;
border:1px solid rgba(192,192,192,.2);
border-radius:12px;
background:var(--input-bg);
color:#fff;
font-size:15px;
outline:none
}
input:focus{border-color:var(--neon-purple)}
input.error{
border-color:#ff4d4d;
box-shadow:0 0 10px rgba(255,77,77,.2)
}
.clear-btn{
position:absolute;
right:12px;
top:50%;
transform:translateY(-50%);
font-size:18px;
cursor:pointer;
display:none;
opacity:.7
}
.suggestions{
position:absolute;
top:100%;
left:0;
right:0;
background:#2a2a2a;
border:1px solid var(--neon-purple);
border-radius:12px;
z-index:1000;
display:none;
max-height:250px;
overflow-y:auto
}
.suggestion-item{
padding:12px;
border-bottom:1px solid #333;
cursor:pointer;
font-size:13px
}
.btn-add-point{
color:var(--neon-purple);
font-size:13px;
font-weight:800;
border:none;
background:none;
cursor:pointer;
padding:5px 0 15px;
text-transform:uppercase
}
.remove-point{
color:#ff4d4d;
font-size:11px;
font-weight:800;
cursor:pointer;
float:right
}
.class-selector{
display:flex;
gap:8px;
margin-bottom:20px
}
.class-btn{
flex:1;
padding:10px 5px;
border-radius:10px;
border:1px solid var(--silver);
background:var(--input-bg);
font-size:10px;
font-weight:800;
cursor:pointer;
text-transform:uppercase;
text-align:center
}
.class-btn.active{
background:var(--neon-purple);
border-color:var(--neon-purple);
color:#fff;
box-shadow:0 0 10px rgba(188,19,254,.4)
}
.price-section{
border:2px solid var(--neon-yellow);
border-radius:18px;
padding:15px;
margin:25px 0
}
.price-row{
display:flex;
justify-content:space-between;
align-items:center
}
.price-display{
font-size:30px;
font-weight:800;
color:var(--neon-yellow)
}
.btn-round{
width:45px;height:45px;border-radius:50%;
border:1px solid var(--neon-purple);
background:#252525;
color:var(--neon-purple);
font-size:24px;
cursor:pointer
}
.pay-btn{
flex:1;
padding:14px;
border-radius:12px;
border:1px solid var(--silver);
text-align:center;
font-weight:700;
cursor:pointer
}
.pay-btn.active{
background:var(--neon-purple);
border-color:var(--neon-purple);
color:#fff
}
.order-button{
width:100%;
padding:20px;
background:var(--neon-yellow);
border:none;
border-radius:16px;
font-size:18px;
font-weight:800;
cursor:pointer
}
</style>
</head>

<body>

<div class="container">
<div class="top-info-row">
<div class="version-label">v 2.1</div>
<div id="city-status" onclick="toggleCitySelector()">ГОРОД: ОПРЕДЕЛЕНИЕ…</div>
</div>

<div id="city-selector-box" class="field-group" style="display:none">
<label>Выбор города</label>
<div class="input-wrapper">
<input id="city-input" placeholder="Введите город" oninput="getCitySuggestions(this)">
<span class="clear-btn" onclick="clearField('city-input')">✕</span>
</div>
<div class="suggestions"></div>
</div>

<div class="field-group">
<label>Откуда</label>
<div class="input-wrapper">
<input id="from" placeholder="Улица и дом" oninput="getSuggestions(this)">
<span class="clear-btn" onclick="clearField('from')">✕</span>
</div>
<div class="suggestions"></div>
</div>

<div id="extra-stops"></div>
<button class="btn-add-point" onclick="addStopField()">+ Добавить точку</button>

<div class="field-group">
<label>Куда</label>
<div class="input-wrapper">
<input id="to" placeholder="Место назначения" oninput="getSuggestions(this)">
<span class="clear-btn" onclick="clearField('to')">✕</span>
</div>
<div class="suggestions"></div>
</div>

<label>Класс автомобиля</label>
<div class="class-selector">
<div class="class-btn active" onclick="selectClass(this,'econom',300)">Эконом</div>
<div class="class-btn" onclick="selectClass(this,'comfort',450)">Комфорт</div>
<div class="class-btn" onclick="selectClass(this,'business',800)">Бизнес</div>
</div>

<div class="price-section">
<div class="price-row">
<button class="btn-round" onclick="adjustPrice(-50)">−</button>
<div class="price-display" id="display_price">300 ₽</div>
<button class="btn-round" onclick="adjustPrice(50)">+</button>
</div>
</div>

<div style="display:flex;gap:10px">
<div id="pay-cash" class="pay-btn active" onclick="setPayment('Наличные')">НАЛИЧНЫЕ</div>
<div id="pay-online" class="pay-btn" onclick="setPayment('Перевод')">ПЕРЕВОД</div>
</div>

<button class="order-button" onclick="confirmOrder()">ПОЕХАЛИ</button>
</div>

<script>
const tg = Telegram.WebApp;
tg.expand();

/* ⚠️ В ПРОДАКШЕНЕ УБРАТЬ НА BACKEND */
const DADATA_API_KEY = "ВАШ_КЛЮЧ";

let basePrice=300, manualAdjustment=0;
let selectedClass="Эконом", paymentMethod="Наличные";
let detectedCity=null, searchTimeout;

window.onload=()=>autoLocate(true);

function selectClass(el,type,price){
selectedClass=type==="econom"?"Эконом":type==="comfort"?"Комфорт":"Бизнес";
basePrice=price;
manualAdjustment=0;
document.querySelectorAll('.class-btn').forEach(b=>b.classList.remove('active'));
el.classList.add('active');
updatePrice();
}

function adjustPrice(v){
if(basePrice+manualAdjustment+v>=100){
manualAdjustment+=v;
updatePrice();
}
}

function updatePrice(){
document.getElementById('display_price').innerText=(basePrice+manualAdjustment)+" ₽";
}

function setPayment(m){
paymentMethod=m;
document.getElementById('pay-cash').classList.toggle('active',m==="Наличные");
document.getElementById('pay-online').classList.toggle('active',m==="Перевод");
}

function hasHouse(str){
return /(д\.?\s*\d+|\d+[а-я]?)/i.test(str);
}

function confirmOrder(){
const from=document.getElementById('from');
const to=document.getElementById('to');
let ok=true;
[from,to,...document.querySelectorAll('.stop-input')].forEach(i=>{
if(!hasHouse(i.value)){i.classList.add('error');ok=false}
else i.classList.remove('error');
});
if(!ok){alert("Укажите номер дома");return;}
tg.sendData(JSON.stringify({
city:detectedCity||"Не определён",
from:from.value,
to:to.value,
class:selectedClass,
price:basePrice+manualAdjustment,
pay:paymentMethod
}));
tg.close();
}
</script>
</body>
</html>
